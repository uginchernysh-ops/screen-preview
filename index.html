<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Screen Preview с масштабированием</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(to bottom, #2c3e50, #1a2530);
      color: #ecf0f1;
      line-height: 1.6;
      padding: 20px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      transition: background 0.5s ease;
    }
    
    .interface-container {
      width: 100%;
      max-width: 100%;
      display: flex;
      flex-direction: column;
      gap: 20px;
      flex: 1;
      transform-origin: top center;
      transition: transform 0.3s ease;
    }
    
    header {
      text-align: center;
      padding: 15px;
      background: rgba(0, 0, 0, 0.4);
      border-radius: 10px;
      backdrop-filter: blur(10px);
      margin-bottom: 10px;
    }
    
    h1 {
      font-size: clamp(1.5rem, 4vw, 2.2rem);
      margin-bottom: 10px;
      color: #3498db;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
    }
    
    .subtitle {
      font-size: clamp(0.9rem, 2vw, 1.1rem);
      color: #bdc3c7;
    }
    
    .main-content {
      display: flex;
      gap: 20px;
      flex: 1;
      min-height: 0;
    }
    
    @media (max-width: 900px) {
      .main-content {
        flex-direction: column;
      }
    }
    
    .control-panel {
      flex: 0 0 300px;
      background: rgba(0, 0, 0, 0.4);
      padding: 20px;
      border-radius: 10px;
      backdrop-filter: blur(10px);
      display: flex;
      flex-direction: column;
    }
    
    @media (max-width: 768px) {
      .control-panel {
        flex: 0 0 auto;
      }
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #3498db;
      font-size: clamp(0.9rem, 2vw, 1rem);
    }
    
    select, input[type="range"], button, input[type="color"] {
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 5px;
      font-size: clamp(0.9rem, 2vw, 1rem);
      background: #34495e;
      color: #ecf0f1;
      margin-bottom: 10px;
    }
    
    select:focus, input[type="range"]:focus {
      outline: 2px solid #3498db;
    }
    
    .file-upload {
      border: 2px dashed #7f8c8d;
      border-radius: 8px;
      padding: 20px;
      text-align: center;
      margin-bottom: 20px;
      transition: all 0.3s;
      cursor: pointer;
    }
    
    .file-upload:hover {
      border-color: #3498db;
      background: rgba(52, 152, 219, 0.1);
    }
    
    .file-input {
      display: none;
    }
    
    .scale-controls {
      background: rgba(52, 73, 94, 0.6);
      padding: 15px;
      border-radius: 8px;
      margin-top: auto;
    }
    
    .additional-controls {
      background: rgba(52, 73, 94, 0.6);
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
    }
    
    .scale-display {
      display: flex;
      justify-content: space-between;
      margin-top: 5px;
      color: 'none';
      canvas.style.display = 'none';
      inFile.value = '';
      
      // Update info panel
      currentScreen.textContent = sel.options[sel.selectedIndex].text;
      screenResolution.textContent = `${scr.w} × ${scr.h}`;
      aspectRatio.textContent = calculateAspectRatio(scr.w, scr.h);
      
      // Масштабируем маску под высоту окна браузера
      scaleMaskToWindow();
      
      setTimeout(autoFit, 50);
    }

    // Функция для масштабирования маски под высоту окна браузера
    function scaleMaskToWindow() {
      const scr = screens[sel.value];
      const screenHeight = scr.fitH || scr.h;
      const screenWidth = scr.fitW || scr.w;
      
      // Определяем доступную высоту области просмотра
      const previewContainer = document.querySelector('.preview-container');
      const availableHeight = previewContainer.clientHeight;
      
      // Вычисляем масштаб на основе высоты экрана и доступного пространства
      let maskScale = availableHeight / screenHeight;
      
      // Применяем масштабирование к контейнеру маски
      cont.style.transform = `scale(${maskScale})`;
      
      // Обновляем значение в слайдере
      scaleSlider.value = Math.max(10, Math.min(200, Math.floor(maskScale * 100)));
      scaleValue.textContent = `${scaleSlider.value}%`;
      scalePercent.textContent = `${scaleSlider.value}%`;
    }

    // Fullscreen functionality
    fullscreenBtn.addEventListener('click', toggleFullscreen);
    
    function toggleFullscreen() {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen().catch(err => {
          console.error(`Error attempting to enable full-screen mode: ${err.message}`);
        });
        fullscreenBtn.textContent = 'Выйти из полноэкранного режима';
      } else {
        if (document.exitFullscreen) {
          document.exitFullscreen();
          fullscreenBtn.textContent = 'Полный экран';
        }
      }
    }

    // Event listeners
    sel.addEventListener('change', updateScreen);
    scaleSlider.addEventListener('input', updateScale);
    autoFitBtn.addEventListener('click', autoFit);
    opacitySlider.addEventListener('input', updateOpacity);
    bgColorPicker.addEventListener('input', updateBackground);
    window.addEventListener('resize', function() {
      if (scaleSlider.value == 100) autoFit();
      scaleMaskToWindow();
    });

    inFile.addEventListener('change', e => {
      const file = e.target.files[0];
      if (!file) return;
      const scr = screens[sel.value];
      const cw = scr.fitW || scr.w;
      const ch = scr.fitH || scr.h;
      
      if (file.type.startsWith('image/')) {
        vid.style.display = 'none';
        canvas.style.display = 'block';
        canvas.width = cw;
        canvas.height = ch;
        const img = new Image();
        img.onload = () => {
          ctx.clearRect(0, 0, cw, ch);
          const sc = Math.min(cw / img.width, ch / img.height);
          const w = img.width * sc;
          const h = img.height * sc;
          ctx.drawImage(img, (cw - w) / 2, (ch - h) / 2, w, h);
        };
        img.src = URL.createObjectURL(file);
        // Apply current opacity
        setTimeout(() => {
          canvas.style.opacity = opacitySlider.value / 100;
        }, 100);
      } else {
        canvas.style.display = 'none';
        vid.style.display = 'block';
        vid.width = cw;
        vid.height = ch;
        vid.src = URL.createObjectURL(file);
        vid.play();
        // Apply current opacity
        vid.style.opacity = opacitySlider.value / 100;
      }
    });

    // Initialize
    updateScreen();
    updateScale();
    updateBackground();
    
    // Set color preview
    colorPreview.style.backgroundColor = bgColorPicker.value;
    
    // Adjust layout on load
    window.addEventListener('load', function() {
      autoFit();
      scaleMaskToWindow();
    });
  </script>
</body>
</html>
